import{j as n,r as u,R as _}from"./index-B_gVeGiv.js";import{u as y}from"./Responsive-CZkJ6WC4.js";import{M as I,L as N}from"./Latex-BO5rSga0.js";function V(e,t){return t===null?!1:t===e.correctOptionId}function L(e,t){if(t===null||isNaN(t))return!1;const{exactValue:r,tolerance:o=0}=e.validation;return Math.abs(t-r)<=o}function S(e,t){return e.type==="multiple_choice"?V(e,t):L(e,t)}function P(e){return e.type==="multiple_choice"?e.correctOptionId:e.validation.exactValue}function E(e){if(e.type==="multiple_choice"){const t=e.options.find(r=>r.id===e.correctOptionId);return(t==null?void 0:t.text)??e.correctOptionId}else{const{exactValue:t,tolerance:r}=e.validation;return r&&r>0?`${t} (Â±${r})`:t.toString()}}function H(e,t){const r=S(e,t),o=e.points??1;return{questionId:e.id,userAnswer:t,correctAnswer:P(e),isCorrect:r,points:r?o:0}}function w(e,t,r=60){let o=0,s=0,i=0,l=0,c=0;for(const x of e){const g=t[x.id]??null,b=x.points??1;c+=b,g===null||g===""?i++:S(x,g)?(o++,l+=b):s++}const a=e.length,d=a>0?Math.round(o/a*100):0,f=d>=r;return{correct:o,wrong:s,unanswered:i,total:a,percentage:d,passed:f,totalPoints:l,maxPoints:c}}function U(e,t){return e.map(r=>{const o=t[r.id]??null;return H(r,o)})}function G(e,t){const r=t[e];return r!=null&&r!==""}function J(e,t){return e.filter(r=>G(r.id,t)).length}function K(e){return e>=80?"#22c55e":e>=60?"#f59e0b":"#ef4444"}function X(e,t){return e===100?"Perfetto! Tutte le risposte sono corrette!":e>=90?"Ottimo lavoro!":e>=80?"Molto bene!":e>=70?"Buon risultato!":t?"Quiz superato!":e>=50?"Quasi! Riprova per migliorare.":"Continua a esercitarti!"}function z(e){let t=[...e.questions];return e.shuffleQuestions&&(t=C(t)),e.shuffleOptions&&(t=t.map(r=>r.type==="multiple_choice"?{...r,options:C([...r.options])}:r)),t}function C(e){const t=[...e];for(let r=t.length-1;r>0;r--){const o=Math.floor(Math.random()*(r+1));[t[r],t[o]]=[t[o],t[r]]}return t}const Y={default:{bg:"#f8fafc",border:"#e2e8f0",text:"#334155",hover:"#f1f5f9"},selected:{bg:"#eff6ff",border:"#3b82f6",text:"#1e40af",hover:"#dbeafe"},correct:{bg:"#f0fdf4",border:"#22c55e",text:"#166534",hover:"#dcfce7"},wrong:{bg:"#fef2f2",border:"#ef4444",text:"#991b1b",hover:"#fee2e2"},missed:{bg:"#fefce8",border:"#eab308",text:"#854d0e",hover:"#fef9c3"}};function Z({option:e,isSelected:t,state:r="default",disabled:o=!1,onSelect:s}){const{isMobile:i}=y(),c=Y[r==="default"&&t?"selected":r],a={width:i?32:28,height:i?32:28,borderRadius:"50%",background:t||r!=="default"?c.border:"#e2e8f0",color:t||r!=="default"?"#fff":"#64748b",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600,fontSize:i?14:13,flexShrink:0};return n.jsxs("button",{onClick:()=>!o&&s(e.id),disabled:o,style:{width:"100%",display:"flex",alignItems:"center",gap:12,padding:i?"14px 16px":"12px 16px",background:c.bg,border:`2px solid ${c.border}`,borderRadius:12,cursor:o?"not-allowed":"pointer",textAlign:"left",fontSize:i?15:14,color:c.text,transition:"all 0.15s ease",opacity:o&&r==="default"?.6:1},children:[n.jsx("span",{style:a,children:e.id.toUpperCase()}),n.jsx("span",{style:{flex:1},children:e.isLatex?n.jsx(N,{children:e.text}):e.text}),r==="correct"&&n.jsx("span",{children:"âœ“"}),r==="wrong"&&n.jsx("span",{children:"âœ—"})]})}function F({value:e,onChange:t,placeholder:r="Inserisci la risposta...",unit:o,disabled:s=!1,state:i="default"}){const{isMobile:l}=y(),c=i==="correct"?"#22c55e":i==="wrong"?"#ef4444":"#d1d5db",a=i==="correct"?"#f0fdf4":i==="wrong"?"#fef2f2":"#fff";return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"number",value:e,onChange:d=>t(d.target.value),placeholder:r,disabled:s,style:{flex:1,padding:l?"14px 16px":"12px 16px",fontSize:16,borderRadius:12,border:`2px solid ${c}`,background:a,outline:"none",minHeight:l?52:48,boxSizing:"border-box"}}),o&&n.jsx("span",{style:{fontSize:14,color:"#64748b",fontWeight:500},children:o}),i==="correct"&&n.jsx("span",{style:{color:"#22c55e",fontSize:20},children:"âœ“"}),i==="wrong"&&n.jsx("span",{style:{color:"#ef4444",fontSize:20},children:"âœ—"})]})}function oe({current:e,total:t,answeredCount:r}){const o=Math.round((e+1)/t*100);return n.jsxs("div",{style:{marginBottom:20},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsxs("span",{style:{fontSize:14,fontWeight:600,color:"#334155"},children:["Domanda ",e+1," di ",t]}),n.jsxs("span",{style:{fontSize:13,color:"#64748b"},children:[r,"/",t," risposte"]})]}),n.jsx("div",{style:{height:8,background:"#e2e8f0",borderRadius:4,overflow:"hidden"},children:n.jsx("div",{style:{width:`${o}%`,height:"100%",background:"linear-gradient(90deg, #3b82f6, #8b5cf6)",borderRadius:4,transition:"width 0.3s ease"}})})]})}function q({isCorrect:e,explanation:t,showCorrectAnswer:r=!1,correctAnswerText:o}){const s=e?"#f0fdf4":"#fef2f2",i=e?"#22c55e":"#ef4444",l=e?"#166534":"#991b1b",c=e?"âœ“":"âœ—",a=e?"Corretto!":"Sbagliato";return n.jsxs("div",{style:{marginTop:16,padding:16,background:s,border:`1px solid ${i}`,borderRadius:12,color:l},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[n.jsx("span",{style:{fontSize:18},children:c}),n.jsx("span",{style:{fontWeight:600},children:a})]}),n.jsx("div",{style:{fontSize:14,lineHeight:1.5},children:t}),r&&!e&&o&&n.jsxs("div",{style:{marginTop:12,paddingTop:12,borderTop:`1px solid ${i}`,fontSize:14},children:[n.jsx("strong",{children:"Risposta corretta:"})," ",o]})]})}function ie({question:e,currentAnswer:t,onAnswer:r,showFeedback:o=!1,isCorrect:s,disabled:i=!1}){const[l,c]=u.useState(t!==null?String(t):""),a=d=>{c(d);const f=parseFloat(d);r(isNaN(f)?null:f)};return _.useEffect(()=>{e.type==="numeric"&&c(t!==null?String(t):"")},[t,e.type]),n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[n.jsx("div",{style:{fontSize:16,fontWeight:500,color:"#1e293b",marginBottom:20,lineHeight:1.5},children:e.promptLatex?n.jsx(I,{children:e.prompt}):e.prompt}),e.difficulty&&n.jsx("div",{style:{marginBottom:16},children:n.jsx("span",{style:{fontSize:12,padding:"4px 8px",borderRadius:4,background:e.difficulty==="facile"?"#dcfce7":e.difficulty==="medio"?"#fef3c7":"#fee2e2",color:e.difficulty==="facile"?"#166534":e.difficulty==="medio"?"#92400e":"#991b1b"},children:e.difficulty.charAt(0).toUpperCase()+e.difficulty.slice(1)})}),e.type==="multiple_choice"&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:e.options.map(d=>{let f="default";if(o){const x=d.id===e.correctOptionId,g=d.id===t;g&&x?f="correct":g&&!x?f="wrong":!g&&x&&(f="missed")}return n.jsx(Z,{option:d,isSelected:d.id===t,state:f,disabled:i||o,onSelect:x=>r(x)},d.id)})}),e.type==="numeric"&&n.jsx(F,{value:l,onChange:a,placeholder:e.placeholder,unit:e.unit,disabled:i||o,state:o?s?"correct":"wrong":"default"}),o&&s!==void 0&&n.jsx(q,{isCorrect:s,explanation:s?e.explanation.correct:e.explanation.wrong,showCorrectAnswer:!s,correctAnswerText:s?void 0:E(e)})]})}function se({score:e,questions:t,answers:r,onRetry:o,onBack:s}){const{isMobile:i}=y(),[l,c]=u.useState(!1),a=U(t,r),d=K(e.percentage),f=X(e.percentage,e.passed);return n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:i?20:32,boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[n.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[n.jsx("div",{style:{width:120,height:120,borderRadius:"50%",background:`linear-gradient(135deg, ${d}20, ${d}40)`,border:`4px solid ${d}`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:n.jsxs("span",{style:{fontSize:36,fontWeight:700,color:d},children:[e.percentage,"%"]})}),n.jsx("h2",{style:{fontSize:24,fontWeight:700,color:"#1e293b",marginBottom:8},children:f}),n.jsxs("p",{style:{color:"#64748b",fontSize:14},children:[e.correct," corrette, ",e.wrong," sbagliate",e.unanswered>0&&`, ${e.unanswered} senza risposta`]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:24},children:[n.jsx(j,{label:"Corrette",value:e.correct,color:"#22c55e"}),n.jsx(j,{label:"Sbagliate",value:e.wrong,color:"#ef4444"}),n.jsx(j,{label:"Senza risposta",value:e.unanswered,color:"#94a3b8"})]}),n.jsxs("button",{onClick:()=>c(!l),style:{width:"100%",padding:"12px 16px",background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:500,color:"#334155",marginBottom:16,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("span",{children:"Vedi dettagli risposte"}),n.jsx("span",{style:{transform:l?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"â–¼"})]}),l&&n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12,marginBottom:24},children:a.map((x,g)=>{const b=t[g];return n.jsx(ee,{index:g+1,question:b,result:x},x.questionId)})}),n.jsxs("div",{style:{display:"flex",gap:12},children:[s&&n.jsx("button",{onClick:s,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"1px solid #d1d5db",background:"#fff",color:"#334155",fontSize:14,fontWeight:600,cursor:"pointer"},children:"â† Torna indietro"}),o&&n.jsx("button",{onClick:o,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"none",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Riprova"})]})]})}function j({label:e,value:t,color:r}){return n.jsxs("div",{style:{padding:16,background:`${r}10`,borderRadius:12,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:r,marginBottom:4},children:t}),n.jsx("div",{style:{fontSize:12,color:"#64748b"},children:e})]})}function ee({index:e,question:t,result:r}){const o=r.isCorrect?"#f0fdf4":r.userAnswer===null?"#f8fafc":"#fef2f2",s=r.isCorrect?"#22c55e":r.userAnswer===null?"#e2e8f0":"#ef4444";return n.jsxs("div",{style:{padding:12,background:o,border:`1px solid ${s}`,borderRadius:8},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[n.jsxs("span",{style:{fontWeight:600,fontSize:14,color:"#334155"},children:["Domanda ",e]}),n.jsx("span",{style:{fontSize:12,padding:"2px 8px",borderRadius:4,background:r.isCorrect?"#dcfce7":"#fee2e2",color:r.isCorrect?"#166534":"#991b1b"},children:r.isCorrect?"Corretta":r.userAnswer===null?"Senza risposta":"Sbagliata"})]}),n.jsxs("div",{style:{fontSize:13,color:"#64748b"},children:[n.jsx("div",{style:{marginBottom:4},children:t.promptLatex?n.jsx(I,{children:t.prompt}):t.prompt.slice(0,100)+(t.prompt.length>100?"...":"")}),!r.isCorrect&&n.jsxs("div",{style:{marginTop:8,fontSize:12},children:[n.jsxs("span",{style:{color:"#991b1b"},children:["Tua risposta:"," ",r.userAnswer===null?"â€”":k(t,r.userAnswer)]}),n.jsx("br",{}),n.jsxs("span",{style:{color:"#166534"},children:["Risposta corretta:"," ",k(t,r.correctAnswer)]})]})]})]})}function k(e,t){if(t===null)return"â€”";if(e.type==="multiple_choice"){const r=e.options.find(o=>o.id===t);return r?`${t.toString().toUpperCase()}) ${r.text}`:t.toString()}return t.toString()}function le({title:e,description:t,children:r,backLink:o="#/",backText:s="â† Torna alla home"}){return n.jsxs("div",{style:{maxWidth:700,margin:"auto",padding:16,fontFamily:"system-ui, sans-serif"},children:[n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("a",{href:o,style:{color:"#3b82f6",textDecoration:"none",fontSize:14},children:s}),n.jsx("h1",{style:{margin:"8px 0",fontSize:24,color:"#1e293b"},children:e}),t&&n.jsx("p",{style:{color:"#64748b",margin:0,fontSize:14},children:t})]}),r]})}function ae({title:e,description:t,questionCount:r,timeLimit:o,onStart:s}){return n.jsxs("div",{style:{background:"#fff",borderRadius:16,padding:32,textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[n.jsx("div",{style:{fontSize:48,marginBottom:16},children:"ðŸ“"}),n.jsx("h2",{style:{fontSize:24,fontWeight:700,color:"#1e293b",marginBottom:8},children:e}),t&&n.jsx("p",{style:{color:"#64748b",fontSize:14,marginBottom:24,maxWidth:400,margin:"0 auto 24px"},children:t}),n.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:24,marginBottom:32},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#3b82f6"},children:r}),n.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Domande"})]}),o&&n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#8b5cf6"},children:Math.floor(o/60)}),n.jsx("div",{style:{fontSize:13,color:"#64748b"},children:"Minuti"})]})]}),n.jsx("button",{onClick:s,style:{padding:"16px 48px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",color:"#fff",fontSize:16,fontWeight:600,cursor:"pointer",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"Inizia il Quiz"})]})}function de({onPrev:e,onNext:t,onSubmit:r,onShowFeedback:o,isFirst:s,isLast:i,canSubmit:l,showFeedbackButton:c=!1,feedbackShown:a=!1}){const{isMobile:d}=y();return n.jsxs("div",{style:{display:"flex",gap:12,marginTop:20,flexDirection:d?"column":"row"},children:[n.jsx("button",{onClick:e,disabled:s,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"1px solid #d1d5db",background:s?"#f1f5f9":"#fff",color:s?"#94a3b8":"#334155",fontSize:14,fontWeight:500,cursor:s?"not-allowed":"pointer"},children:"â† Precedente"}),c&&o&&!a&&n.jsx("button",{onClick:o,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"none",background:"#22c55e",color:"#fff",fontSize:14,fontWeight:500,cursor:"pointer"},children:"Verifica"}),i?n.jsx("button",{onClick:r,disabled:!l,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"none",background:l?"linear-gradient(135deg, #3b82f6, #8b5cf6)":"#94a3b8",color:"#fff",fontSize:14,fontWeight:600,cursor:l?"pointer":"not-allowed"},children:"Termina Quiz"}):n.jsx("button",{onClick:t,style:{flex:1,padding:"14px 20px",borderRadius:10,border:"none",background:"#3b82f6",color:"#fff",fontSize:14,fontWeight:500,cursor:"pointer"},children:"Successiva â†’"})]})}function ce({quiz:e,onComplete:t,showImmediateFeedback:r=!1}){const[o,s]=u.useState(()=>z(e)),[i,l]=u.useState({status:"not_started",currentIndex:0,answers:{}}),[c,a]=u.useState(null),d=u.useMemo(()=>i.status!=="completed"?null:w(o,i.answers,e.passingScore??60),[i.status,o,i.answers,e.passingScore]),f=u.useMemo(()=>i.status==="not_started"||i.status==="completed"?null:o[i.currentIndex]??null,[o,i.currentIndex,i.status]),x=i.currentIndex===0,g=i.currentIndex===o.length-1,b=o.length>0?Math.round((i.currentIndex+1)/o.length*100):0,v=J(o,i.answers),R=v>0,M=u.useCallback(()=>{const p=z(e);s(p),l({status:"in_progress",currentIndex:0,answers:{},startedAt:Date.now()}),a(null)},[e]),Q=u.useCallback((p,h)=>{l(m=>({...m,answers:{...m.answers,[p]:h}})),a(null)},[]),W=u.useCallback(()=>{l(p=>({...p,currentIndex:Math.min(p.currentIndex+1,o.length-1)})),a(null)},[o.length]),B=u.useCallback(()=>{l(p=>({...p,currentIndex:Math.max(p.currentIndex-1,0)})),a(null)},[]),A=u.useCallback(p=>{const h=Math.max(0,Math.min(p,o.length-1));l(m=>({...m,currentIndex:h})),a(null)},[o.length]),$=u.useCallback(()=>{const p=w(o,i.answers,e.passingScore??60);l(h=>({...h,status:"completed",completedAt:Date.now()})),a(null),t==null||t(p)},[o,i.answers,e.passingScore,t]),T=u.useCallback(()=>{l({status:"not_started",currentIndex:0,answers:{}}),a(null)},[]),D=u.useCallback(()=>{if(!r||!f)return;const p=i.answers[f.id]??null,h=S(f,p);a({isCorrect:h,shown:!0})},[r,f,i.answers]),O=u.useCallback(()=>{a(null)},[]);return{state:i,questions:o,currentQuestion:f,score:d,start:M,answer:Q,next:W,prev:B,goTo:A,submit:$,reset:T,isFirst:x,isLast:g,progress:b,answeredCount:v,canSubmit:R,currentFeedback:c,showFeedback:D,hideFeedback:O}}export{le as Q,ae as a,oe as b,ie as c,de as d,se as e,ce as u};
